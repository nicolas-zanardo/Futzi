<div class="container pt-5 pb-5">
  <h1>Gestion des membres</h1>
  <div class="barre-title mb-5"></div>


  <h4>Contact Club</h4>
  <form class="form" class="mb-5" [formGroup]="formContact" (submit)="submitFormUserContact()">
    <mat-form-field appearance="fill"  class="w-100">
      <mat-label>Nom du contact</mat-label>
      <mat-select required [(value)]="selected" formControlName="contact">

        <mat-form-field class="w-100 pt-3 px-3">
          <mat-label>Recheche</mat-label>
          <input matInput (keyup)="filterUserList()" formControlName="search">
        </mat-form-field>

        <mat-option class="py-2" *ngFor="let user of listUsersContact" [value]="user.value">
          {{user.name}}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <div class="d-flex justify-content-end">
      <button type="buton" class="" mat-raised-button color="primary"><mat-icon matSuffix>done</mat-icon>Modifier</button>
    </div>
  </form>





  <div class="mat-elevation-z8">

    <div class="p-3">
      <h4>Recherche</h4>
      <mat-form-field class="w-100 pb-0 mb-0">
        <mat-label>Filter</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Ex. Mia">
      </mat-form-field>
    </div>


    <table mat-table
           [dataSource]="dataSource" multiTemplateDataRows matSort
           class="mat-elevation-z8">
      <ng-container matColumnDef="{{item.column}}" *ngFor="let item of columnsToDisplay" >
        <th mat-header-cell *matHeaderCellDef mat-sort-header > <b>{{item.name}}</b> </th>
        <td mat-cell *matCellDef="let element">{{element[item.column]}}</td>
      </ng-container>
      <ng-container matColumnDef="expand" class="d-flex">
        <th mat-header-cell *matHeaderCellDef aria-label="row actions" class="text-center"><b>STATUT</b></th>
        <td mat-cell *matCellDef="let element" class="text-center">
          <button mat-flat-button class="w-100 btnExpend" [style]="setBackgroundColorInfoUserStatus(element.info_status)" aria-label="expand row" (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation()">
            <span class="small-text d-flex align-items-center text-white">{{element.info_status}}
              <mat-icon *ngIf="expandedElement !== element">keyboard_arrow_down</mat-icon>
              <mat-icon *ngIf="expandedElement === element">keyboard_arrow_up</mat-icon>
            </span>
          </button>
        </td>
      </ng-container>

      <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
      <ng-container matColumnDef="expandedDetail">
        <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayWithExpand.length">
          <div class="element-detail"
               [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">

            <div class="element-description">
              <div class="py-3">
                <h5>Contact</h5>
                <div>☎ tel: {{element.phone_number}}</div>
                <div>✉ email: {{element.email}}</div>
              </div>
              <div class="py-3 d-flex align-items-center" *ngIf="currentUser?.id != element.id ">
                <div>
                  <h5>Statut de l'utilisateur</h5>

                  <mat-form-field appearance="fill" >
                    <mat-select [compareWith]="selectedStatus" [value]="element.ROLE" #input>
                      <mat-option *ngFor="let status of objStatus" [value]="status.ROLE">
                        {{status.info_status}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <form class="form-inline px-3" (submit)="submitChangeStatus(element.id, currentUser?.id, input.value)" [formGroup]="formChangeStatus">
                  <button mat-raised-button color="primary">valid</button>
                </form>
              </div>

            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
      <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;"
          class="element-row"
          [class.expanded-row]="expandedElement === element"
          (click)="expandedElement = expandedElement === element ? null : element">
      </tr>
      <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page of users" class="pb-4"></mat-paginator>
  </div>



</div>
